#/bin/sh

cd /usr/portage;

{
	for F in *-*/*/; do
		bash -c "
			echo -en \"${F%/}\t\";
			source $F*ebuild 2>/dev/null;
			perl -e 's/[\s\r\n]+/ /s for @ARGV; printf \"%s\t(%s)\n\", @ARGV' \"\$(echo \$DESCRIPTION)\" \"\$(echo \$HOMEPAGE)\"
		";
	done;
} | tee /var/lib/portage/searchdesc.new &&
	mv /var/lib/portage/searchdesc.new /var/lib/portage/searchdesc ||
	rm /var/lib/portage/searchdesc.new
